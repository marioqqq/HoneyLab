- name: Configure desktop environment
  hosts: localhost
  become: true
  tasks:
    # - name: Remove Firefox
    #   apt:
    #     name: firefox
    #     state: absent
    #     purge: yes
    #     autoremove: yes
    #     update_cache: yes

    # - name: Install required packages
    #   apt:
    #     name:
    #       - curl
    #       - gnupg
    #     state: present
    #     update_cache: yes

    # - name: Download Brave browser GPG key
    #   get_url:
    #     url: https://brave-browser-apt-release.s3.brave.com/brave-browser-archive-keyring.gpg
    #     dest: /usr/share/keyrings/brave-browser-archive-keyring.gpg

    # - name: Add Brave APT repository
    #   apt_repository:
    #     repo: "deb [signed-by=/usr/share/keyrings/brave-browser-archive-keyring.gpg] https://brave-browser-apt-release.s3.brave.com/ stable main"
    #     state: present
    #     filename: brave-browser

    # - name: Update APT cache
    #   apt:
    #     update_cache: yes

    # - name: Install Brave browser
    #   apt:
    #     name: brave-browser
    #     state: latest

    # - name: Download latest VS Code .deb
    #   shell: |
    #     curl -L -o /tmp/code_latest.deb "https://code.visualstudio.com/sha/download?build=stable&os=linux-deb-x64"
    #   args:
    #     executable: /bin/bash

    # - name: Install VS Code
    #   apt:
    #     deb: /tmp/code_latest.deb

    - name: Get latest release information from GitHub API
      uri:
        url: https://api.github.com/repos/rustdesk/rustdesk/releases/latest
        method: GET
        return_content: yes
      register: github_release_info

    - name: Extract the download URL for the .deb file
      set_fact:
        deb_file_url: "{{ github_release_info.json.assets | selectattr('name', 'search', '.*\.deb') | map(attribute='browser_download_url') | first }}"

    - name: Download the .deb file
      get_url:
        url: "{{ deb_file_url }}"
        dest: "/tmp/rustdesk_latest.deb"

    - name: Install the .deb file (optional, if you want to install it after download)
      apt:
        deb: "/tmp/rustdesk_latest.deb"
        state: present
